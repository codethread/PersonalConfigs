#-------------------------------------------------------------------------------------------------``
#--- Global
#--------------------------------------------------------------------------------------------------
set -s escape-time 10
# set -sg repeat-time 400                   # allow moving between panes quicker, turned off while using prefixless pane movement
set -g history-limit 5000                 # boost history

set -g mouse on
set -g set-titles on          # set terminal title

unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

set -g base-index 1           # start windows numbering at 1

bind r command-prompt -p "Rename Session:" "rename-session '%%'"

# VI like
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

#-------------------------------------------------------------------------------------------------``
#--- Session
#--------------------------------------------------------------------------------------------------
# use telescope-tmux for picking sessions
# bind a display-popup -E -w 80% -h 80% nvim -c ":Telescope tmux sessions quit_on_select=true theme=ivy"
bind-key "s" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/session.sh attatch"

# create session
bind C-c new-session
bind -r BTab switch-client -l  # move to last session

#-------------------------------------------------------------------------------------------------``
#--- Window
#--------------------------------------------------------------------------------------------------
setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed
set -g main-pane-width 60% # good for default main layout (bound to C-=)

# use telescope-tmux for picking windows
# bind w display-popup -E -w 80% -h 80% nvim -c ":Telescope tmux windows quit_on_select=true theme=ivy"
bind-key "w" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/window.sh switch"

bind -r p previous-window # select previous window
bind -r n next-window     # select next window
bind -r Tab last-window        # move to last active window

#-------------------------------------------------------------------------------------------------``
#--- Pane
#--------------------------------------------------------------------------------------------------
setw -g pane-base-index 1     # make pane numbering consistent with windows

bind Space resize-pane -Z # zoom pane
bind = select-layout main-vertical # reset layout to my prefered |-

# pane movement
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# pane resizing
bind -r H resize-pane -L 2
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 2

# split panes using | and -
unbind '"'
unbind %
bind -r - split-window -c "#{pane_current_path}"
bind -r | split-window -h -c "#{pane_current_path}"

# pane movement
bind-key u command-prompt -p "join pane from:"  "swap-pane -t '%%'"
bind-key b break-pane -d

# join another pane
bind-key "C-s" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/pane.sh swap"
# 'dismiss' current pane
bind-key "C-d" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/pane.sh join"

#-------------------------------------------------------------------------------------------------``
#--- UI
#--------------------------------------------------------------------------------------------------
# TODO: one day sort this out
set -g default-terminal "xterm-256color-italic"
set-option -ga terminal-overrides ',*:enacs@:smacs@:rmacs@:acsc@'

# The modes
setw -g clock-mode-colour colour135
setw -g mode-style fg=colour209,bg=colour08,bold

# The panes
set -g pane-border-style bg="default",fg="#686868"
set -g pane-active-border-style bg="default",fg="cyan"

#-------------------------------------------------------------------------------------------------``
#--- STATUS LINE
#--------------------------------------------------------------------------------------------------
set -g status-justify left
set -g status-interval 2 # frequency in seconds of refresh
set -g status-position bottom
set -g status-justify centre
set -g status-style bg="default",fg="blue"

STATUS_CURRENT_='#[fg=cyan,bold]#{?client_prefix,#[fg=yellow],} #S '
STATUS_BATTERY_='#[fg=cyan,bg=default]#{battery_status_fg}♥ #{battery_percentage} '
STATUS_CPU_='#{cpu_fg_color}☀ #{cpu_percentage} '

STATUS_DATE_='#{?client_prefix,#[fg=yellow],} %H:%M:%S | %A %d %b  '

set -g status-right-length 100
set -g status-left-length 100

set -g status-left $STATUS_CURRENT_$STATUS_BATTERY_$STATUS_CPU_$STATUS_POMO_
set -g status-right $STATUS_DATE_

# window status
set -g window-status-current-format "#[fg=cyan, bold] #I: #W#{?window_zoomed_flag,#[bold]+,}"
set -g window-status-format "#[fg=blue] #I: #W#{?window_zoomed_flag,#[bold]+,}"

set -g window-status-bell-style fg=colour255,bg=colour1,bold

# The messages
set -g message-command-style fg=blue,bg=default
set -g message-style fg="cyan",bg="default",bold

#-------------------------------------------------------------------------------------------------``
#--- PLUGINS
#--------------------------------------------------------------------------------------------------
set -g @cpu_low_fg_color "#[fg=#686868]"
set -g @cpu_medium_fg_color "#[fg=yellow]"
set -g @cpu_high_fg_color "#[fg=red]"

set -g @batt_color_full_charge "#[fg=#686868]"
set -g @batt_color_high_charge "#[fg=green]"
set -g @batt_color_medium_charge "#[fg=yellow]"
set -g @batt_color_low_charge "#[fg=red]"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'christoomey/vim-tmux-navigator' # move between vim/tmux smoothly
# set -g @plugin 'wfxr/tmux-fzf-url' # prefix + u to fzf urls

set -g @fuzzback-popup 1
set -g @plugin 'roosta/tmux-fuzzback' # prefix + ? to fzf history

# set -g @jump-key 's'
# set -g @plugin 'schasse/tmux-jump'

# set -g @menus_trigger 'x'
# set -g @menus_location_x 'C'
# set -g @menus_location_y 'C'
# set -g @plugin 'jaclu/tmux-menus' -- this is nice, but don't have much need for now

# TMUX_FZF_SESSION_FORMAT
# TMUX_FZF_WINDOW_FORMAT
# TMUX_FZF_LAUNCH_KEY="C-f"
TMUX_FZF_LAUNCH_KEY="\\;"
TMUX_FZF_PANE_FORMAT="#{window_index}.#{pane_index} #{?window_active,+,}#{window_name} - #{pane_current_command} #{pane_current_path}"
set -g @plugin 'sainnhe/tmux-fzf'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"
run '~/.tmux/plugins/tpm/tpm'
