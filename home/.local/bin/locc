#!/usr/bin/env bash

git log --no-merges --numstat --pretty=format:'AUTHOR:%aN' -10000 -- . ':!testing' | awk '
  /^AUTHOR:/ { author = substr($0, 8); next }
  /^[0-9]/ {
    added[author] += $1
    deleted[author] += $2
    files[author]++
  }
  END {
    for (author in added) {
      total = added[author] + deleted[author]
      printf "%s|+%d|-%d|%d files|%d total\n", author, added[author], deleted[author], files[author], total
    }
  }
' | sort -t'|' -k5 -rn | head -20 | column -t -s'|'
