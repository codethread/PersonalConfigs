#!/usr/bin/env bash
# :module: Synchronization and file backup management script

echo "Starting sync"

directory="$HOME/sync"

LOGDIR="$HOME/.local/state/com.codethread.syncengine"
mkdir -p "$LOGDIR"
mkdir -p "$directory"

# Loop over each file in the directory
if [ -d "$directory" ]; then
  for file in "$directory"/*; do
    logfile="$LOGDIR/${file##*/}.log"
    gitwatch -r origin -R "$file" >"$logfile" 2>&1 &
    echo "Running syncengine on $file and logging to $logfile"
  done
fi

file="$HOME/Library/Mobile Documents/com~apple~CloudDocs/Documents/Notes"
if [ -d "$file" ]; then
  logfile="$LOGDIR/notes.log"
  gitwatch -r origin -R "$file" >"$logfile" 2>&1 &
  echo "Running syncengine on $file and logging to $logfile"
fi

wait
