#!/bin/bash

# git-show: Show commits around a specific commit
# Usage: git-show <sha> [number]
# Example: git-show 48f16eb633 2

set -e

if [ $# -lt 1 ]; then
    echo "Usage: git-show <sha> [number]"
    echo "Example: git-show 48f16eb633 2"
    exit 1
fi

SHA="$1"
NUMBER="${2:-2}"  # Default to 2 if not provided

# Validate that the commit exists
if ! git rev-parse --verify "$SHA" >/dev/null 2>&1; then
    echo "Error: Commit '$SHA' not found"
    exit 1
fi

# Pick a ref that actually contains the commit (prefer current branch).
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
if git merge-base --is-ancestor "$SHA" "$CURRENT_BRANCH" >/dev/null 2>&1; then
    TARGET_REF="$CURRENT_BRANCH"
else
    TARGET_REF=$(git for-each-ref --contains "$SHA" --sort=-committerdate --format='%(refname:short)' refs/heads refs/remotes | head -1)
fi

if [ -z "$TARGET_REF" ]; then
    echo "Error: No local or remote branch contains commit '$SHA'"
    exit 1
fi

# Show commits before
echo "=== $NUMBER commit(s) BEFORE ==="
git log --oneline -"$NUMBER" "$SHA^" 2>/dev/null || git log --oneline -"$NUMBER" "$SHA~1"

# Show target commit
echo -e "\n=== TARGET COMMIT ==="
git log --oneline -1 "$SHA"

# Show commits after
echo -e "\n=== $NUMBER commit(s) AFTER ==="
AFTER_COMMITS=$(git log --reverse --oneline "$SHA".."$TARGET_REF" | head -"$NUMBER")
if [ -z "$AFTER_COMMITS" ]; then
    echo "(no commits after this one on $TARGET_REF)"
else
    echo "$AFTER_COMMITS"
fi

